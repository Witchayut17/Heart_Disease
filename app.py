import streamlit as st
import numpy as np
import joblib

st.set_page_config(page_title="‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÇ‡∏£‡∏Ñ‡∏´‡∏±‡∏ß‡πÉ‡∏à", layout="wide")

st.title("‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÇ‡∏£‡∏Ñ‡∏´‡∏±‡∏ß‡πÉ‡∏à")

@st.cache_resource
def load_model():
    return joblib.load('rf_model.joblib')

model = load_model()

col1, col2 = st.columns([2, 1])  # ‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Å‡∏ß‡πà‡∏≤ ‡∏ù‡∏±‡πà‡∏á‡∏Ç‡∏ß‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏Å‡∏ß‡πà‡∏≤

with col1:
    st.subheader("‡∏õ‡πâ‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì")
    with st.form(key='heart_risk_form'):
        thal = st.selectbox('‡∏†‡∏≤‡∏ß‡∏∞‡∏ò‡∏≤‡∏•‡∏±‡∏™‡∏ã‡∏µ‡πÄ‡∏°‡∏µ‡∏¢ (thal)', options=[3,6,7],
                            format_func=lambda x: {3:"‡∏õ‡∏Å‡∏ï‡∏¥",6:"‡∏Ç‡πâ‡∏≠‡∏ö‡∏Å‡∏û‡∏£‡πà‡∏≠‡∏á‡∏ñ‡∏≤‡∏ß‡∏£",7:"‡∏Ç‡πâ‡∏≠‡∏ö‡∏Å‡∏û‡∏£‡πà‡∏≠‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ"}[x])
        cp = st.selectbox('‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏à‡πá‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏Å (cp)', options=[1,2,3,4])
        ca = st.selectbox('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ (ca)', options=[0,1,2,3,4])
        exang = st.selectbox('‡πÄ‡∏à‡πá‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢ (exang)', options=[0,1], format_func=lambda x: "‡πÑ‡∏°‡πà‡∏°‡∏µ" if x==0 else "‡∏°‡∏µ")
        sex = st.selectbox('‡πÄ‡∏û‡∏®', options=[0,1], format_func=lambda x: '‡∏´‡∏ç‡∏¥‡∏á' if x==0 else '‡∏ä‡∏≤‡∏¢')
        oldpeak = st.slider('ST depression (oldpeak)', 0.0, 10.0, 1.0, 0.1)
        thalach = st.slider('‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡πâ‡∏ô‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (thalach)', 60, 250, 150)
        chol = st.slider('‡∏Ñ‡∏≠‡πÄ‡∏•‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡∏≠‡∏• (chol)', 100, 600, 200)
        trestbps = st.slider('‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏Ç‡∏ì‡∏∞‡∏û‡∏±‡∏Å (trestbps)', 50, 250, 120)
        age = st.slider('‡∏≠‡∏≤‡∏¢‡∏∏', 1, 120, 50)

        submit_button = st.form_submit_button(label='‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á')

    if submit_button:
        input_data = np.array([[ 
            int(cp), float(trestbps), float(chol), float(thalach), int(exang),
            float(oldpeak), int(ca), int(thal), float(age), int(sex)
        ]])

        try:
            prediction = model.predict(input_data)[0]

            if prediction == 0:
                st.success("‚úÖ ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≥ ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏£‡∏Ñ‡∏´‡∏±‡∏ß‡πÉ‡∏à (Class 0)")
            else:
                st.error(f"‚ö†Ô∏è ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏£‡∏Ñ‡∏´‡∏±‡∏ß‡πÉ‡∏à (Class {prediction})")

        except Exception as e:
            st.error(f"‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢: {e}")

with col2:
    with st.expander("üìå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", expanded=True):

        # ‡πÅ‡∏ñ‡∏ß 1: ‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏•‡∏≤‡∏™
        st.markdown("""
        ### ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏•‡∏≤‡∏™‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (target)
        - Class 0: 29 ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á (47.54%)
        - Class 1: 12 ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á (19.67%)
        - Class 2: 9 ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á (14.75%)
        - Class 3: 7 ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á (11.48%)
        - Class 4: 4 ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á (6.56%)
        """)

        # ‡πÅ‡∏ñ‡∏ß 2: ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏ô (5 ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÅ‡∏£‡∏Å)
        st.markdown("""
        ### ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå (normalized/scaled) - ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1
        | ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå     | mean  | min   | max   | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏à‡∏£‡∏¥‡∏á‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)                  |
        |-------------|-------|-------|-------|----------------------------------------------|
        | cp          | 2.43  | 0     | 3     | ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏à‡πá‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏Å 0-3 (0=‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î, 3=‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)    |
        | trestbps    | -0.13 | -1.89 | 2.33  | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏Ç‡∏ì‡∏∞‡∏û‡∏±‡∏Å (50-250 mm Hg)              |
        | chol        | 0.05  | -2.41 | 2.64  | ‡∏Ñ‡∏≠‡πÄ‡∏•‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡∏≠‡∏• (100-600 mg/dL)                    |
        | thalach     | -0.09 | -2.72 | 1.43  | ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡πâ‡∏ô‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (60-250 bpm)            |
        | exang       | 0.28  | 0     | 1     | ‡πÄ‡∏à‡πá‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢ (0=‡πÑ‡∏°‡πà‡∏°‡∏µ, 1=‡∏°‡∏µ)           |
        """)

        # ‡πÅ‡∏ñ‡∏ß 3: ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏™‡πà‡∏ß‡∏ô‡∏•‡πà‡∏≤‡∏á (5 ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏´‡∏•‡∏±‡∏á)
        st.markdown("""
        ### ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå (normalized/scaled) - ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2
        | ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå     | mean  | min   | max   | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏à‡∏£‡∏¥‡∏á‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)                  |
        |-------------|-------|-------|-------|----------------------------------------------|
        | oldpeak     | 0.02  | -0.92 | 2.68  | ST depression                                 |
        | ca          | 0.75  | 0     | 3     | ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤                    |
        | thal        | 0.93  | 0     | 2     | ‡∏†‡∏≤‡∏ß‡∏∞‡∏ò‡∏≤‡∏•‡∏±‡∏™‡∏ã‡∏µ‡πÄ‡∏°‡∏µ‡∏¢ (0-2)                         |
        | sex         | 0.77  | 0     | 1     | ‡πÄ‡∏û‡∏® (0=‡∏´‡∏ç‡∏¥‡∏á, 1=‡∏ä‡∏≤‡∏¢)                           |
        | age         | -0.16 | -2.27 | 1.83  | ‡∏≠‡∏≤‡∏¢‡∏∏ (1-120 ‡∏õ‡∏µ) (normalized)                    |
        """)

        # ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏¢‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°)
        st.markdown("""
        ### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏Ñ‡∏•‡∏≤‡∏™

        - **Class 0 (‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≥):**
          - cp: 1-2 (‡πÄ‡∏à‡πá‡∏ö‡∏ô‡πâ‡∏≠‡∏¢‡∏ñ‡∏∂‡∏á‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á)
          - ca: 0-1
          - exang: 0 (‡πÑ‡∏°‡πà‡∏°‡∏µ)
          - oldpeak: < 1.0
          - thalach: > 150 bpm
          - chol: < 240 mg/dL
          - trestbps: < 130 mm Hg
          - age: < 50 ‡∏õ‡∏µ
          - sex: ‡∏ä‡∏≤‡∏¢/‡∏´‡∏ç‡∏¥‡∏á
          - thal: ‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Ç‡πâ‡∏≠‡∏ö‡∏Å‡∏û‡∏£‡πà‡∏≠‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ (3 ‡∏´‡∏£‡∏∑‡∏≠ 6)

        - **Class 1 - 3 (‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á):**
          - cp: 2-3
          - ca: 1-3
          - exang: 0 ‡∏´‡∏£‡∏∑‡∏≠ 1
          - oldpeak: 1.0-2.5
          - thalach: 120-150 bpm
          - chol: 240-300 mg/dL
          - trestbps: 130-160 mm Hg
          - age: 50-65 ‡∏õ‡∏µ
          - sex: ‡∏ä‡∏≤‡∏¢/‡∏´‡∏ç‡∏¥‡∏á
          - thal: ‡∏Ç‡πâ‡∏≠‡∏ö‡∏Å‡∏û‡∏£‡πà‡∏≠‡∏á‡∏ñ‡∏≤‡∏ß‡∏£ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Å‡∏•‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ (6 ‡∏´‡∏£‡∏∑‡∏≠ 7)

        - **Class 4 (‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á):**
          - cp: 4
          - ca: 3-4
          - exang: 1 (‡∏°‡∏µ)
          - oldpeak: > 2.5
          - thalach: < 120 bpm
          - chol: > 300 mg/dL
          - trestbps: > 160 mm Hg
          - age: > 65 ‡∏õ‡∏µ
          - sex: ‡∏ä‡∏≤‡∏¢/‡∏´‡∏ç‡∏¥‡∏á
          - thal: ‡∏Ç‡πâ‡∏≠‡∏ö‡∏Å‡∏û‡∏£‡πà‡∏≠‡∏á‡∏ñ‡∏≤‡∏ß‡∏£ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Å‡∏•‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ (6 ‡∏´‡∏£‡∏∑‡∏≠ 7)
        """)
